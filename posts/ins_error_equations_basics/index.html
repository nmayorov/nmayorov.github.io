<!doctype html><html lang=en><head><title>INS error equations · My Blog</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=color-scheme content="light dark"><meta name=description content="In this note I want to derive Inertial Navigation System (INS) error equations from the first principles. This is of course a well known subject, however it&rsquo;s useful to derive all the equations from scratch and revisit the subject from time to time.
INS state variables and equations for them Link to heading An Inertial Navigation System computes position, velocity and attitude of a moving object using measurements from an Inertial Measurement Unit (IMU)."><meta name=keywords content><meta name=twitter:card content="summary"><meta name=twitter:title content="INS error equations"><meta name=twitter:description content="In this note I want to derive Inertial Navigation System (INS) error equations from the first principles. This is of course a well known subject, however it&rsquo;s useful to derive all the equations from scratch and revisit the subject from time to time.
INS state variables and equations for them Link to heading An Inertial Navigation System computes position, velocity and attitude of a moving object using measurements from an Inertial Measurement Unit (IMU)."><meta property="og:title" content="INS error equations"><meta property="og:description" content="In this note I want to derive Inertial Navigation System (INS) error equations from the first principles. This is of course a well known subject, however it&rsquo;s useful to derive all the equations from scratch and revisit the subject from time to time.
INS state variables and equations for them Link to heading An Inertial Navigation System computes position, velocity and attitude of a moving object using measurements from an Inertial Measurement Unit (IMU)."><meta property="og:type" content="article"><meta property="og:url" content="https://nmayorov.github.io/posts/ins_error_equations_basics/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2022-12-15T00:00:00+00:00"><meta property="article:modified_time" content="2022-12-15T00:00:00+00:00"><link rel=canonical href=https://nmayorov.github.io/posts/ins_error_equations_basics/><link rel=preload href="/fonts/forkawesome-webfont.woff2?v=1.2.0" as=font type=font/woff2 crossorigin><link rel=stylesheet href=/css/coder.min.c4d7e93a158eda5a65b3df343745d2092a0a1e2170feeec909b8a89443903c6a.css integrity="sha256-xNfpOhWO2lpls980N0XSCSoKHiFw/u7JCbiolEOQPGo=" crossorigin=anonymous media=screen><link rel=icon type=image/png href=/images/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=/images/favicon-16x16.png sizes=16x16><link rel=apple-touch-icon href=/images/apple-touch-icon.png><link rel=apple-touch-icon sizes=180x180 href=/images/apple-touch-icon.png><link rel=manifest href=/site.webmanifest><link rel=mask-icon href=/images/safari-pinned-tab.svg color=#5bbad5><meta name=generator content="Hugo 0.108.0"></head><body class="preload-transitions colorscheme-light"><div class=float-container><a id=dark-mode-toggle class=colorscheme-toggle><i class="fa fa-adjust fa-fw" aria-hidden=true></i></a></div><main class=wrapper><nav class=navigation><section class=container><a class=navigation-title href=/>My Blog</a>
<input type=checkbox id=menu-toggle>
<label class="menu-button float-right" for=menu-toggle><i class="fa fa-bars fa-fw" aria-hidden=true></i></label><ul class=navigation-list><li class=navigation-item><a class=navigation-link href=/posts/>Posts</a></li></ul></section></nav><div class=content><section class="container post"><article><header><div class=post-title><h1 class=title><a class=title-link href=https://nmayorov.github.io/posts/ins_error_equations_basics/>INS error equations</a></h1></div><div class=post-meta><div class=date><span class=posted-on><i class="fa fa-calendar" aria-hidden=true></i>
<time datetime=2022-12-15T00:00:00Z>December 15, 2022</time></span>
<span class=reading-time><i class="fa fa-clock-o" aria-hidden=true></i>
11-minute read</span></div></div></header><div><p>In this note I want to derive Inertial Navigation System (INS) error equations from the first principles.
This is of course a well known subject, however it&rsquo;s useful to derive all the equations from scratch and revisit the subject from time to time.</p><h1 id=ins-state-variables-and-equations-for-them>INS state variables and equations for them
<a class=heading-link href=#ins-state-variables-and-equations-for-them><i class="fa fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h1><p>An Inertial Navigation System computes position, velocity and attitude of a moving object using measurements from an Inertial Measurement Unit (IMU).</p><p>To formulate necessary equations frames of reference need to be defined (denoted by lowercase letters):</p><ul><li>$e$ &ndash; ECEF frame</li><li>$n$ &ndash; NED frame</li><li>$b$ &ndash; body frame with axes along inertial sensor axes</li></ul><p>A vector $u$ expressed in a frame $a$ is denoted as $u^a$.</p><p>Variables computed by INS are:</p><ul><li>Position as latitude, longitude and altitude &ndash; $\varphi, \lambda, h$</li><li>Velocity relative to the ground (frame $e$) expressed in frame $n$ &ndash; $V^n = \begin{bmatrix} V_N & V_E & V_D \end{bmatrix}^T$</li><li>Attitude as rotation matrix from frame $n$ to frame $b$ &ndash; $C^n_b$</li></ul><p>The differential equations for the state variables are:
$$
\dot{\varphi} = \frac{V_N}{R_N + h} \\[1 pt]
\dot{\lambda} = \frac{V_E}{(R_E + h) \cos \varphi} \\
\dot{h} = -V_D \\
\dot{V}^n = -(2 \Omega^n + \rho^n) \times V^n + g^n + C^n_b f^b \\
\dot{C}^n_b = C^n_b (\omega^b \times) - ([\Omega^n + \rho^n] \times) C^n_b
$$
Where the following variables were introduce:</p><ul><li>$R_N$ and $R_E$ &ndash; North and East curvature radii</li><li>$\Omega^n$ &ndash; Earth angular rate</li><li>$\rho^n$ &ndash; transport rate, i. e. angular rate of $n$ frame relative to $e$ frame due to object&rsquo;s velocity</li><li>$g^n$ &ndash; gravity vector</li><li>$f^b$ &ndash; accelerometer measurements of specific force</li><li>$\omega^b$ &ndash; gyro measurements of angular rate relative to an inertial frame</li><li>$(\cdot \times)$ &ndash; cross-product skew symmetric matrix defined as $(u \times) v \equiv u \times v$</li></ul><p>The INS computer updates the state variables according to the equations using gyro and accel measurements containing errors:
$$
\tilde{\omega} = \omega^b + \Delta \omega \\
\tilde{f} = f^b + \Delta f \\
$$
The computed or estimated variables will be marked with hat.</p><h1 id=error-definitions>Error definitions
<a class=heading-link href=#error-definitions><i class="fa fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h1><p>Errors must express deviation of estimated variables from true variables.
They don&rsquo;t need to be direct differences of the variables.</p><p>There are several conventional ways to introduce error variables for INS.
I will choose the most straightforward approach from which it&rsquo;s possible to derive equations for other parametrizations.</p><p>The selected parametrization are usually called &ldquo;phi-angle error model&rdquo;.</p><h2 id=position-error>Position error
<a class=heading-link href=#position-error><i class="fa fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h2><p>Direct differences of latitude, longitude and altitude are not particularly convenient to interpret as well as to derive equations for.
Instead we can use correspondence of latitude, longitude, altitude and coordinates in ECEF, which we denote as $r^e$.</p><p>Define the position error as:
$$
\Delta r^n = C^n_e (\hat{r}^e - r^e)
$$
That is it ECEF coordinate errors projected into NED frame.</p><p>Relations between $\Delta r^n$ and geographic coordinates errors are
$$
\Delta r_N = (R_N + h) \Delta \varphi \\
\Delta r_E = (R_E + h) \cos \varphi \Delta \lambda \\
\Delta r_N = - \Delta h
$$</p><h2 id=velocity-error>Velocity error
<a class=heading-link href=#velocity-error><i class="fa fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h2><p>The velocity error is defined as direct difference:
$$
\Delta V^n = \hat{V}^n - V^n
$$</p><h2 id=attitude-error>Attitude error
<a class=heading-link href=#attitude-error><i class="fa fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h2><p>Attitude error is defined as a rotation vector $\phi$ associated with $n$ frame according to the following equation:
$$
C^n_b = \exp(\phi \times) \hat{C}^n_b
$$
Where the matrix exponential is used.
It has a closed form formula and to the first order in $\phi$ can be expressed as
$$
\exp(\phi \times) \approx I + (\phi \times)
$$</p><h1 id=helper-formulas>Helper formulas
<a class=heading-link href=#helper-formulas><i class="fa fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h1><p>The curvature radii are computed as
$$
R_N = \frac{a (1 - e^2)}{(1 - e^2 \sin^2 \varphi)^{3/2}} \\
R_E = \frac{a}{1 - e^2 \sin^2 \varphi}
$$
Where $a$ is Earth ellipsoid semi-major axis and $e$ is its eccentricity.
Considering that $e^2 \approx 7 \cdot 10^{-3}$ the dependency of the radii on the latitude is ignored for the error analysis.</p><p>The transport rate is computed as
$$
\rho^n = \begin{bmatrix}
\dfrac{V_E}{R_E + h} \\
-\dfrac{V_N}{R_N + h} \\
-\dfrac{V_E \tan \varphi}{R_E + h}
\end{bmatrix} = F V^n
$$
The matrix $F$ relates a linear displacement in $n$ frame to its small angular rotation.
The error of the transport rate due to position and velocity errors is
$$
\Delta \rho^n = R \Delta r^n + T \Delta V^n
$$
Where matrices $T$ and $R$ are defined as
$$
T = \begin{bmatrix}
0 & \dfrac{1}{R_E + h} & 0 \\
-\dfrac{1}{R_N + h} & 0 & 0 \\
0 & -\dfrac{\tan \varphi}{R_E + h} & 0
\end{bmatrix} \\[2pt]
R = \begin{bmatrix}
0 & 0 & \dfrac{V_E}{(R_E + h)^2} \\
0 & 0 & -\dfrac{V_N}{(R_N + h)^2} \\
-\dfrac{V_E \sec^2 \varphi}{(R_E + h) (R_N + h)} & 0 & -\dfrac{V_E \tan \varphi}{(R_E + h)^2}
\end{bmatrix}
$$</p><p>The Earth rotation rate in $n$ frame has the form
$$
\Omega^n = \Omega \begin{bmatrix}
\cos \varphi \\
0 \\
-\sin \varphi
\end{bmatrix}
$$
Its perturbation due to the position error can be shown to be
$$
\Delta \Omega^n = (\Omega^n \times) T \Delta r^n
$$</p><p>The gravity model is
$$
g^n = \begin{bmatrix}
0 \\
0 \\
g(\varphi) \left(1 - \dfrac{2 h}{a} \right)
\end{bmatrix}
$$
The weak dependency in $g(\varphi)$ can be ignored in the error analysis.
The gravity vector perturbation due to the position error:
$$
\Delta g^n = G \Delta r^n
$$
with
$$
G = \begin{bmatrix}
0 & 0 & 0 \\
0 & 0 & 0 \\
0 & 0 & \dfrac{2 g}{a} \\
\end{bmatrix}
$$</p><h1 id=position-error-equation-derivation>Position error equation derivation
<a class=heading-link href=#position-error-equation-derivation><i class="fa fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h1><p>Differentiating the position error we get
$$
\begin{split}
\Delta \dot{r}^n = \dot{C}^n_e (\hat{r}^e - r^e) + C^n_e (\dot{\hat{r}}^e - \dot{r}^e) = -(\rho^n \times) C^n_e (\hat{r}^e - r^e) + C^n_e (\hat{V}^e - V^e) = \\
= -\rho^n \times \Delta r^n + C^n_e \hat{C}^e_n \hat{V}^n - V^n \approx -\rho^n \times \Delta r^n + (I + (\theta \times)) (V^n + \Delta V^n) - V^n \approx \\
\approx -\rho^n \times \Delta r^n + \Delta V^n + \theta \times V^n
\end{split}
$$
Where we&rsquo;ve used equations
$$
\dot{C}^e_n = C^e_n (\rho^n \times) \\
\dot{r}^e = V^e \\
\hat{C}^e_n \approx C^e_n (I + (\theta \times))
$$
Substituting $\theta = T \Delta r^n$ (by the same logic that the rotational perturbation $\theta$ of frame $n$ is caused by the linear perturbation $\Delta r^n$) we get:
$$
\Delta \dot{r}^n = -\left[ (\rho^n \times) + (V^n \times) T \right] \Delta r^n + \Delta V^n
$$</p><h1 id=velocity-error-equation-derivation>Velocity error equation derivation
<a class=heading-link href=#velocity-error-equation-derivation><i class="fa fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h1><p>To derive the velocity error equation we subtract the equation for the true velocity from the equation for the INS estimated velocity keeping linear terms:
$$
\Delta \dot{V}^n = -(2 \Omega^n + \rho^n) \times \Delta V^n - (2 \Delta \Omega^n + \Delta \rho^n) \times V^n + \Delta g^n + (I - \phi \times) C^n_b (f^b + \Delta f) - C^n_b f^b
$$
Substituting expressions for all $\Delta$-s we get
$$
\Delta \dot{V}^n = -(2 \Omega^n + \rho^n) \times \Delta V^n + (V^n \times) (2 (\Omega^n \times) T \Delta r^n + R \Delta r^n + T \Delta V^n) + G \Delta r^n + (C^n_b f^b) \times \phi + C^n_b \Delta f
$$
And after the grouping the terms:
$$
\Delta \dot{V}^n = \left[2 (V^n \times) (\Omega^n \times) T + (V^n \times) R + G \right] \Delta r^n + \left[ -([2 \Omega^n + \rho^n]\times) + (V^n \times) T \right] \Delta V^n + (C^n_b f^b) \times \phi + C^n_b \Delta f
$$</p><h1 id=attitude-error-equation-derivation>Attitude error equation derivation
<a class=heading-link href=#attitude-error-equation-derivation><i class="fa fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h1><p>Let&rsquo;s first derive a general equation.</p><h2 id=differential-equation-for-a-small-rotation-vector-as-attitude-error>Differential equation for a small rotation vector as attitude error
<a class=heading-link href=#differential-equation-for-a-small-rotation-vector-as-attitude-error><i class="fa fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h2><p>Consider the rotation kinematics equation for a matrix $C$:
$$
\dot{C} = C (\omega \times) - (\xi \times) C
$$
Where $\omega$ and $\xi$ are angular rates of the frames between which $C$ transforms relative to some third frame.
And the same dynamics for its estimate:
$$
\dot{\hat{C}} = C (\hat{\omega} \times) - (\hat{\xi} \times) \hat{C} \text{ with } \hat{\omega} = \omega + \Delta \omega, \hat{\xi} = \xi + \Delta \xi
$$
Define the relation between the matrices to the first order in a rotation vector $\phi$ as
$$
C \approx (I + \phi \times) \hat{C}
$$
From this we get the differential equation for $\phi$:
$$
\begin{split}
(\dot{\phi} \times) = \dot{C} \hat{C}^T + C \dot{\hat{C}}^T = [C (\omega \times) - (\xi \times) C ] \hat{C}^T + C[-(\hat{\omega} \times) \hat{C}^T + \hat{C}^T (\hat{\xi} \times)] = \\
= C ([\omega - \hat{\omega}] \times) \hat{C}^T - (\xi \times) C \hat{C}^T + C \hat{C}^T (\hat{\xi} \times)
\end{split}
$$
The first term is already linear in the error, thus in it we can replace $\hat{C}$ with $C$.
In the second and third term we substitute $C \hat{C}^T \approx I + (\phi \times)$:
$$
\begin{split}
(\dot{\phi} \times) \approx -C (\Delta \omega \times) C^T - (\xi \times) (I + \phi \times) + (I + \phi \times) ((\xi + \Delta \xi) \times) = \\
\approx -C (\Delta \omega \times) C^T + (\Delta \xi \times) + (\phi \times) (\xi \times) - (\xi \times) (\phi \times)
\end{split}
$$
This equation can be transformed to a vector form using easy to proof identities:
$$
C (u \times) C^T = ((C u) \times) \text{ if $C$ is a rotation matrix} \\
(u \times ) (v \times) - (v \times) (u \times) = ((u \times v) \times)
$$
After applying them we get a relation for skew symmetric matrices, which can be written in an equivalent vector form:
$$
\dot \phi = -C \Delta \omega + \Delta \xi - \xi \times \phi
$$</p><h2 id=equation-for-the-ins-attitude-error-vector>Equation for the INS attitude error vector
<a class=heading-link href=#equation-for-the-ins-attitude-error-vector><i class="fa fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h2><p>Applying the derived equation to the equation for $C^n_b$ we get for its error vector
$$
\dot{\phi} = -C^n_b \Delta \omega + \Delta \rho^n + \Delta \Omega^n - (\rho^n + \Omega^n) \times \phi
$$
Substituting the angular rate errors we get
$$
\dot{\phi} = (R + (\Omega^n \times) T) \Delta r^n + T \Delta V^n - (\Omega^n + \rho^n) \times \phi -C^n_b \Delta \omega
$$</p><h1 id=summary-of-the-equations>Summary of the equations
<a class=heading-link href=#summary-of-the-equations><i class="fa fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h1><p>Let&rsquo;s write all the equations together:
$$
\Delta \dot{r}^n = -\left[ (\rho^n \times) + (V^n \times) T \right] \Delta r^n + \Delta V^n \\
\Delta \dot{V}^n = \left[2 (V^n \times) (\Omega^n \times) T + (V^n \times) R + G \right] \Delta r^n + \left[ -((2 \Omega^n + \rho^n)\times) + (V^n \times) T \right] \Delta V^n + (C^n_b f^b) \times \phi + C^n_b \Delta f \\
\dot{\phi} = (R + (\Omega^n \times) T) \Delta r^n + T \Delta V^n - (\Omega^n + \rho^n) \times \phi -C^n_b \Delta \omega
$$
They can be implemented exactly like this using corresponding and it&rsquo;s probably the best practical approach.
The explicit matrix expressions as the coefficients are convenient for the implementation.</p><p>Expanding the formula for the vertical position error we get
$$
\Delta \dot{r}_D = \Delta V_D
$$
Which agrees with the simple altitude kinematics equation $\dot{h} = -V_D$.</p><h1 id=simplified-formulas>Simplified formulas
<a class=heading-link href=#simplified-formulas><i class="fa fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h1><p>To reduce symbolic and conceptual clutter we can simplify the formulas if position errors are estimated and corrected (using GNSS etc.)
In this case it can be assumed that $V \Delta r / a \ll \Delta V$.
Then in all the formulas terms with $\Delta r^n$ can be neglected in comparison with terms with $\Delta V^n$.</p><p>With the stated simplification the formulas look like this:
$$
\Delta \dot{r}^n = \Delta V^n \\
\Delta \dot{V}^n = G \Delta r^n + \left[ -((2 \Omega^n + \rho^n)\times) + (V^n \times) T \right] \Delta V^n + (C^n_b f^b) \times \phi + C^n_b \Delta f \\
\dot{\phi} = T \Delta V^n - (\Omega^n + \rho^n) \times \phi - C^n_b \Delta \omega
$$</p><p>Let&rsquo;s briefly discuss these equations:</p><ul><li>Position error equation is straightforward: higher the velocity error &ndash; quicker position error grows</li><li>Rate of change of the vertical velocity error is influenced mainly by incorrectly computed gravity</li><li>Rate of change of the horizontal velocity error is influenced by incorrect heading when horizontal acceleration is applied and always by incorrect roll and pitch (because $f \approx -g$)</li><li>Projected accelerometer error also directly contributes to the rate of change of the velocity error</li><li>Attitude error grows approximately with a rate equal to the projected gyro error</li></ul><h1 id=practical-considerations>Practical considerations
<a class=heading-link href=#practical-considerations><i class="fa fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h1><p>The equations was written as if using true values of the variables to compute its coefficients.
In practice estimated values (as only available) are used for that, it doesn&rsquo;t violate the validity of the equations to the first order in the errors.
However it might create consistency and false observability issues in estimation algorithms and some special care must be taken in practical systems.</p><h1 id=conclusion>Conclusion
<a class=heading-link href=#conclusion><i class="fa fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h1><p>I&rsquo;ve presented a derivation of standard INS error equations with all coefficients given as explicit matrices, which is convenient for implementation.
From this standard &ldquo;phi-angle&rdquo; parametrization other parametrizations might be derived, which I can touch upon in a follow up post.</p></div><footer></footer></article><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/katex.min.css integrity=sha384-R4558gYOUz8mP9YWpZJjofhk+zx0AS11p36HnD2ZKj/6JR5z27gSSULCNHIRReVs crossorigin=anonymous><script defer src=https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/katex.min.js integrity=sha384-z1fJDqw8ZApjGO3/unPWUPsIymfsJmyrDVWC8Tv/a1HeOtGmkwNd/7xUS0Xcnvsx crossorigin=anonymous></script>
<script defer src=https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/contrib/auto-render.min.js integrity=sha384-+XBljXPPiv+OzfbB3cVmLHf4hdUFHlWNZN5spNQ7rmHTXpd7WvJum6fIACpNNfIR crossorigin=anonymous onload='renderMathInElement(document.body,{delimiters:[{left:"$$",right:"$$",display:!0},{left:"$",right:"$",display:!1},{left:"\\(",right:"\\)",display:!1},{left:"\\[",right:"\\]",display:!0}]})'></script></section></div><footer class=footer><section class=container>©
2022
·
Powered by <a href=https://gohugo.io/>Hugo</a> & <a href=https://github.com/luizdepra/hugo-coder/>Coder</a>.</section></footer></main><script src=/js/coder.min.236049395dc3682fb2719640872958e12f1f24067bb09c327b233e6290c7edac.js integrity="sha256-I2BJOV3DaC+ycZZAhylY4S8fJAZ7sJwyeyM+YpDH7aw="></script></body></html>