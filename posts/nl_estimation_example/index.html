<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Solving a nonlinear estimation problem by optimization | Navigating Uncertainty</title>
<meta name=keywords content><meta name=description content="Here I want to demonstrate how the proposed nonlinear estimation algorithm solves an example estimation problem.
Model formulation As a dynamics system for variable $y$ I consider a nonlinear damped oscillator with an external force $a$: $$ \ddot{y} + 2 \eta \omega \dot{y} (1 + \xi \dot{y}^2) + \omega^2 \sin y = a $$ The difference from the linear model are:
The returning force is changed from $y$ to $\sin y$ &ndash; this can be viewed as abandoning the small angle approximation for a gravity pendulum The friction force now nonlinear with an additional factor of $1 + \xi \dot{y}^2$ &ndash; the friction increases for high speed Introducing the variables $$ x_1 \coloneqq y \\ x_2 \coloneqq \dot{y} \\ $$ we rewrite it as a first order system $$ \dot{x_1} = x_2 \\ \dot{x_2} = -\omega^2 \sin x_1 - 2 \eta \omega x_2 (1 + \xi x_2^2) + a $$ Introduce discrete time variables $$ x_k \coloneqq x(k \tau) \\ a_k \coloneqq a(k \tau) $$ Applying the first-order integration method we get the following discrete time equation: $$ x_{k + 1} = f(x_k, a_k) \\ \text{with }f(x, f) = \begin{bmatrix} x_1 + \tau x_2 \\ x_2 - \tau (\omega^2 \sin x_1 + 2 \eta \omega x_2 (1 + \xi x_2^2) + f) \end{bmatrix} $$ Let&rsquo;s introduce the noise sources into it:"><meta name=author content="Nikolay Mayorov"><link rel=canonical href=https://nmayorov.github.io/posts/nl_estimation_example/><link crossorigin=anonymous href=/assets/css/stylesheet.a801c217e3c96db9c9df36cb1d2216a9bc5d9fa77b72e2afcdf47fb847f8f015.css integrity="sha256-qAHCF+PJbbnJ3zbLHSIWqbxdn6d7cuKvzfR/uEf48BU=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.f413e19d0714851f6474e7ee9632408e58ac146fbdbe62747134bea2fa3415e0.js integrity="sha256-9BPhnQcUhR9kdOfuljJAjlisFG+9vmJ0cTS+ovo0FeA=" onload=hljs.initHighlightingOnLoad()></script><link rel=icon href=https://nmayorov.github.io/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://nmayorov.github.io/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://nmayorov.github.io/favicon-32x32.png><link rel=apple-touch-icon href=https://nmayorov.github.io/apple-touch-icon.png><link rel=mask-icon href=https://nmayorov.github.io/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/katex.min.css integrity=sha384-R4558gYOUz8mP9YWpZJjofhk+zx0AS11p36HnD2ZKj/6JR5z27gSSULCNHIRReVs crossorigin=anonymous><script defer src=https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/katex.min.js integrity=sha384-z1fJDqw8ZApjGO3/unPWUPsIymfsJmyrDVWC8Tv/a1HeOtGmkwNd/7xUS0Xcnvsx crossorigin=anonymous></script><script defer src=https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/contrib/auto-render.min.js integrity=sha384-+XBljXPPiv+OzfbB3cVmLHf4hdUFHlWNZN5spNQ7rmHTXpd7WvJum6fIACpNNfIR crossorigin=anonymous onload='renderMathInElement(document.body,{delimiters:[{left:"$$",right:"$$",display:!0},{left:"$",right:"$",display:!1},{left:"\\(",right:"\\)",display:!1},{left:"\\[",right:"\\]",display:!0}]})'></script><meta property="og:title" content="Solving a nonlinear estimation problem by optimization"><meta property="og:description" content="Here I want to demonstrate how the proposed nonlinear estimation algorithm solves an example estimation problem.
Model formulation As a dynamics system for variable $y$ I consider a nonlinear damped oscillator with an external force $a$: $$ \ddot{y} + 2 \eta \omega \dot{y} (1 + \xi \dot{y}^2) + \omega^2 \sin y = a $$ The difference from the linear model are:
The returning force is changed from $y$ to $\sin y$ &ndash; this can be viewed as abandoning the small angle approximation for a gravity pendulum The friction force now nonlinear with an additional factor of $1 + \xi \dot{y}^2$ &ndash; the friction increases for high speed Introducing the variables $$ x_1 \coloneqq y \\ x_2 \coloneqq \dot{y} \\ $$ we rewrite it as a first order system $$ \dot{x_1} = x_2 \\ \dot{x_2} = -\omega^2 \sin x_1 - 2 \eta \omega x_2 (1 + \xi x_2^2) + a $$ Introduce discrete time variables $$ x_k \coloneqq x(k \tau) \\ a_k \coloneqq a(k \tau) $$ Applying the first-order integration method we get the following discrete time equation: $$ x_{k + 1} = f(x_k, a_k) \\ \text{with }f(x, f) = \begin{bmatrix} x_1 + \tau x_2 \\ x_2 - \tau (\omega^2 \sin x_1 + 2 \eta \omega x_2 (1 + \xi x_2^2) + f) \end{bmatrix} $$ Let&rsquo;s introduce the noise sources into it:"><meta property="og:type" content="article"><meta property="og:url" content="https://nmayorov.github.io/posts/nl_estimation_example/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2022-12-06T00:00:00+00:00"><meta property="article:modified_time" content="2022-12-06T00:00:00+00:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="Solving a nonlinear estimation problem by optimization"><meta name=twitter:description content="Here I want to demonstrate how the proposed nonlinear estimation algorithm solves an example estimation problem.
Model formulation As a dynamics system for variable $y$ I consider a nonlinear damped oscillator with an external force $a$: $$ \ddot{y} + 2 \eta \omega \dot{y} (1 + \xi \dot{y}^2) + \omega^2 \sin y = a $$ The difference from the linear model are:
The returning force is changed from $y$ to $\sin y$ &ndash; this can be viewed as abandoning the small angle approximation for a gravity pendulum The friction force now nonlinear with an additional factor of $1 + \xi \dot{y}^2$ &ndash; the friction increases for high speed Introducing the variables $$ x_1 \coloneqq y \\ x_2 \coloneqq \dot{y} \\ $$ we rewrite it as a first order system $$ \dot{x_1} = x_2 \\ \dot{x_2} = -\omega^2 \sin x_1 - 2 \eta \omega x_2 (1 + \xi x_2^2) + a $$ Introduce discrete time variables $$ x_k \coloneqq x(k \tau) \\ a_k \coloneqq a(k \tau) $$ Applying the first-order integration method we get the following discrete time equation: $$ x_{k + 1} = f(x_k, a_k) \\ \text{with }f(x, f) = \begin{bmatrix} x_1 + \tau x_2 \\ x_2 - \tau (\omega^2 \sin x_1 + 2 \eta \omega x_2 (1 + \xi x_2^2) + f) \end{bmatrix} $$ Let&rsquo;s introduce the noise sources into it:"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":2,"name":"Posts","item":"https://nmayorov.github.io/posts/"},{"@type":"ListItem","position":3,"name":"Solving a nonlinear estimation problem by optimization","item":"https://nmayorov.github.io/posts/nl_estimation_example/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Solving a nonlinear estimation problem by optimization","name":"Solving a nonlinear estimation problem by optimization","description":"Here I want to demonstrate how the proposed nonlinear estimation algorithm solves an example estimation problem.\nModel formulation As a dynamics system for variable $y$ I consider a nonlinear damped oscillator with an external force $a$: $$ \\ddot{y} + 2 \\eta \\omega \\dot{y} (1 + \\xi \\dot{y}^2) + \\omega^2 \\sin y = a $$ The difference from the linear model are:\nThe returning force is changed from $y$ to $\\sin y$ \u0026ndash; this can be viewed as abandoning the small angle approximation for a gravity pendulum The friction force now nonlinear with an additional factor of $1 + \\xi \\dot{y}^2$ \u0026ndash; the friction increases for high speed Introducing the variables $$ x_1 \\coloneqq y \\\\ x_2 \\coloneqq \\dot{y} \\\\ $$ we rewrite it as a first order system $$ \\dot{x_1} = x_2 \\\\ \\dot{x_2} = -\\omega^2 \\sin x_1 - 2 \\eta \\omega x_2 (1 + \\xi x_2^2) + a $$ Introduce discrete time variables $$ x_k \\coloneqq x(k \\tau) \\\\ a_k \\coloneqq a(k \\tau) $$ Applying the first-order integration method we get the following discrete time equation: $$ x_{k + 1} = f(x_k, a_k) \\\\ \\text{with }f(x, f) = \\begin{bmatrix} x_1 + \\tau x_2 \\\\ x_2 - \\tau (\\omega^2 \\sin x_1 + 2 \\eta \\omega x_2 (1 + \\xi x_2^2) + f) \\end{bmatrix} $$ Let\u0026rsquo;s introduce the noise sources into it:","keywords":[],"articleBody":"Here I want to demonstrate how the proposed nonlinear estimation algorithm solves an example estimation problem.\nModel formulation As a dynamics system for variable $y$ I consider a nonlinear damped oscillator with an external force $a$: $$ \\ddot{y} + 2 \\eta \\omega \\dot{y} (1 + \\xi \\dot{y}^2) + \\omega^2 \\sin y = a $$ The difference from the linear model are:\nThe returning force is changed from $y$ to $\\sin y$ – this can be viewed as abandoning the small angle approximation for a gravity pendulum The friction force now nonlinear with an additional factor of $1 + \\xi \\dot{y}^2$ – the friction increases for high speed Introducing the variables $$ x_1 \\coloneqq y \\\\ x_2 \\coloneqq \\dot{y} \\\\ $$ we rewrite it as a first order system $$ \\dot{x_1} = x_2 \\\\ \\dot{x_2} = -\\omega^2 \\sin x_1 - 2 \\eta \\omega x_2 (1 + \\xi x_2^2) + a $$ Introduce discrete time variables $$ x_k \\coloneqq x(k \\tau) \\\\ a_k \\coloneqq a(k \\tau) $$ Applying the first-order integration method we get the following discrete time equation: $$ x_{k + 1} = f(x_k, a_k) \\\\ \\text{with }f(x, f) = \\begin{bmatrix} x_1 + \\tau x_2 \\\\ x_2 - \\tau (\\omega^2 \\sin x_1 + 2 \\eta \\omega x_2 (1 + \\xi x_2^2) + f) \\end{bmatrix} $$ Let’s introduce the noise sources into it:\nAssume that $\\omega$ randomly varies from epoch to epoch, i. e. use $\\omega + w_1$ in place $\\omega$ Assume that $\\eta$ randomly varies from epoch to epoch, i. e. use $\\eta + w_2$ in place of $\\eta$ Assume that the external force is a random white sequence, denote it by $w_3$ Then we have the following stochastic function $$ f(x, w) = \\begin{bmatrix} x_1 + \\tau x_2 \\\\ x_2 - \\tau ((\\omega + w_1)^2 \\sin x_1 + 2 (\\eta + w_2) (\\omega + w_1) x_2 (1 + \\xi x_2^2) + w_3) \\end{bmatrix} $$ Such $f$ has nonlinearities in both state and noise which is good for evaluating the method.\nLet’s compute the Jacobian of $f$ with respect to $x$ and $w$: $$ F = \\frac{\\partial f}{\\partial x} = \\begin{bmatrix} 1 \u0026 \\tau \\\\ -\\tau (\\omega + w_1)^2 \\cos x_1 \u0026 1 - 2 \\tau (\\eta + w_2) (\\omega + w_1) (1 + 3 \\xi x_2^2) \\\\ \\end{bmatrix} \\\\ G = \\frac{\\partial f}{\\partial w} = \\begin{bmatrix} 0 \u0026 0 \u0026 0 \\\\ -2 \\tau ((\\omega + w_1) \\sin x_1 + (\\eta + w_2) x_2 (1 + \\xi x_2^2)) \u0026 -2 \\tau (\\omega + w_1) x_2 (1 + \\xi x_2^2) \u0026 \\tau \\end{bmatrix} $$\nFor the measurements let’s assume the following model: $$ z = \\sin x_1 + v $$ This can be interpreted as measuring $y$ coordinate of a gravity pendulum.\nKnowledge on prior statistics on $x_0$ is also available: $$ \\operatorname{E} x_0 = x_0^- \\\\ \\operatorname{E} (x_0 - x_0^-)(x_0 - x_0^-)^T = P_0^- $$\nNumerical values Here the numerical values used for the simulation are provided. We assume that $x_1$ is measured in radians and $x_2$ in radians per second.\nModel constants:\n$\\omega = \\dfrac{2 \\pi}{10}$ Hz $\\eta = 0.5$ $\\xi = 1 \\text{ s}^2$ $\\tau = 0.1 \\text{ s}$ Process noise covariance: $$ Q = \\begin{bmatrix} (0.1 \\text{ rad/s})^2 \u0026 0 \u0026 0 \\\\ 0 \u0026 0.01^2 \u0026 0 \\\\ 0 \u0026 0 \u0026 (0.5 \\text{ rad/s}^2)^2 \\end{bmatrix} $$ Measurement noise covariance: $$ R = \\begin{bmatrix} 0.1^2 \\end{bmatrix} $$ Prior mean and covariance: $$ x_0^- = \\begin{bmatrix} \\pi / 2 \\text{ rad} \\\\ 0 \\text { rad/s} \\end{bmatrix} \\\\ P_0^- = \\begin{bmatrix} (0.1 \\text{ rad})^2 \u0026 0 \\\\ 0 \u0026 (0.05 \\text{ rad/s})^2 \\end{bmatrix} $$\nThe estimation is run over 1000 epochs with tolerance parameters $t_c = t_f = 10^{-8}$ for the optimization.\nAlgorithm’s results Below the algorithm’s metrics by iterations are shown (in log scale for y-axis).\nThe depicted variables have the following meaning:\n“Prior cost” – part of the cost function which accounts for the prior statistics on $x_0$ “Measurement cost” – part of the cost function which accounts for the measurement residuals “Noise cost” – part of the cost function which accounts for the noise magnitude “Total cost” – value of the total cost function “Constraints l1-norm” – l1-norm of the time transition equation residuals (summed over all epochs) The solution at iteration 0 is the EKF solution: it has the lowest cost function (zero prior and noise costs), but doesn’t at all satisfies time transition equations. After 1 iteration the cost function almost reaches its optimal value. Further iterations steadily reduce the constraints violation, which improves the solution smoothness.\nIn this problem 1 iteration, which corresponds to one smoother iteration (sort of «Extended Kalman Smoother»), gives a solution very close to the optimal and quite smooth. But it is generally not guaranteed and the optimization approach gives a proper way to reason about convergence and estimation quality.\nValues of $\\mu$ used in the merit function by iteration are depicted below\nWe can see that $\\mu$ is increased when necessary as explained in the other post.\nBelow the estimated and true values of state variables are depicted. The plots in the second row enlarges the end part of the plots in the first row.\nThe estimates obtained by the optimization are smooth and qualitatively more accurate that the EKF estimates.\nThe estimated error standard deviations are depicted below.\nWe observe already known from the linear case relation between filter and smoother standard deviations.\nMonte-Carlo simulation can and should be done to compare sample RMS and estimated SD of filter and optimization solutions. It won’t be included in this post however.\nRelation between EKF and optimized solutions We see that EKF solution has a low value of the cost function, but neglects the constraints (state time transition equations). As the result the estimates don’t have any smoothness properties: they are perturbed by the noisy measurements and don’t satisfy the time transition equations. From the optimization perspective the EKF solution is simply infeasible, i.e. it’s not considered as a proper solution to the optimization problem.\nThe optimization algorithm «smooths» the EKF solution, with each iteration reducing the residual in the state transition equations. In the process the cost function increases (due to nonzero noise estimates), but it is necessary to satisfy the problem constraints.\nConclusion A solution to the batch nonlinear estimation problem as optimization was demonstrated and compared to the EKF solution. It proved that the optimization is valid and efficient approach for solving nonlinear estimation problems.\n","wordCount":"1071","inLanguage":"en","datePublished":"2022-12-06T00:00:00Z","dateModified":"2022-12-06T00:00:00Z","author":{"@type":"Person","name":"Nikolay Mayorov"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://nmayorov.github.io/posts/nl_estimation_example/"},"publisher":{"@type":"Organization","name":"Navigating Uncertainty","logo":{"@type":"ImageObject","url":"https://nmayorov.github.io/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://nmayorov.github.io accesskey=h title="Navigating Uncertainty (Alt + H)">Navigating Uncertainty</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://nmayorov.github.io/archives title="All posts"><span>All posts</span></a></li><li><a href=https://nmayorov.github.io/tags title=Tags><span>Tags</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://nmayorov.github.io>Home</a>&nbsp;»&nbsp;<a href=https://nmayorov.github.io/posts/>Posts</a></div><h1 class=post-title>Solving a nonlinear estimation problem by optimization</h1><div class=post-meta><span title='2022-12-06 00:00:00 +0000 UTC'>December 6, 2022</span>&nbsp;·&nbsp;6 min&nbsp;·&nbsp;Nikolay Mayorov</div></header><div class=toc><details><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><ul><li><a href=#model-formulation aria-label="Model formulation">Model formulation</a></li><li><a href=#numerical-values aria-label="Numerical values">Numerical values</a></li><li><a href=#algorithms-results aria-label="Algorithm&amp;rsquo;s results">Algorithm&rsquo;s results</a></li><li><a href=#relation-between-ekf-and-optimized-solutions aria-label="Relation between EKF and optimized solutions">Relation between EKF and optimized solutions</a></li><li><a href=#conclusion aria-label=Conclusion>Conclusion</a></li></ul></div></details></div><div class=post-content><p>Here I want to demonstrate how the <a href=https://nmayorov.github.io/posts/nonlinear_batch_estimation/>proposed nonlinear estimation algorithm</a> solves an example estimation problem.</p><h1 id=model-formulation>Model formulation<a hidden class=anchor aria-hidden=true href=#model-formulation>#</a></h1><p>As a dynamics system for variable $y$ I consider a nonlinear damped oscillator with an external force $a$:
$$
\ddot{y} + 2 \eta \omega \dot{y} (1 + \xi \dot{y}^2) + \omega^2 \sin y = a
$$
The difference from the <a href=https://nmayorov.github.io/posts/verify_smoother/#model-formulation>linear model</a> are:</p><ul><li>The returning force is changed from $y$ to $\sin y$ &ndash; this can be viewed as abandoning the small angle approximation for a gravity pendulum</li><li>The friction force now nonlinear with an additional factor of $1 + \xi \dot{y}^2$ &ndash; the friction increases for high speed</li></ul><p>Introducing the variables
$$
x_1 \coloneqq y \\
x_2 \coloneqq \dot{y} \\
$$
we rewrite it as a first order system
$$
\dot{x_1} = x_2 \\
\dot{x_2} = -\omega^2 \sin x_1 - 2 \eta \omega x_2 (1 + \xi x_2^2) + a
$$
Introduce discrete time variables
$$
x_k \coloneqq x(k \tau) \\
a_k \coloneqq a(k \tau)
$$
Applying the first-order integration method we get the following discrete time equation:
$$
x_{k + 1} = f(x_k, a_k) \\
\text{with }f(x, f) = \begin{bmatrix}
x_1 + \tau x_2 \\
x_2 - \tau (\omega^2 \sin x_1 + 2 \eta \omega x_2 (1 + \xi x_2^2) + f)
\end{bmatrix}
$$
Let&rsquo;s introduce the noise sources into it:</p><ul><li>Assume that $\omega$ randomly varies from epoch to epoch, i. e. use $\omega + w_1$ in place $\omega$</li><li>Assume that $\eta$ randomly varies from epoch to epoch, i. e. use $\eta + w_2$ in place of $\eta$</li><li>Assume that the external force is a random white sequence, denote it by $w_3$</li></ul><p>Then we have the following stochastic function
$$
f(x, w) = \begin{bmatrix}
x_1 + \tau x_2 \\
x_2 - \tau ((\omega + w_1)^2 \sin x_1 + 2 (\eta + w_2) (\omega + w_1) x_2 (1 + \xi x_2^2) + w_3)
\end{bmatrix}
$$
Such $f$ has nonlinearities in both state and noise which is good for evaluating the method.</p><p>Let&rsquo;s compute the Jacobian of $f$ with respect to $x$ and $w$:
$$
F = \frac{\partial f}{\partial x} = \begin{bmatrix}
1 & \tau \\
-\tau (\omega + w_1)^2 \cos x_1 & 1 - 2 \tau (\eta + w_2) (\omega + w_1) (1 + 3 \xi x_2^2) \\
\end{bmatrix} \\
G = \frac{\partial f}{\partial w} = \begin{bmatrix}
0 & 0 & 0 \\
-2 \tau ((\omega + w_1) \sin x_1 + (\eta + w_2) x_2 (1 + \xi x_2^2)) & -2 \tau (\omega + w_1) x_2 (1 + \xi x_2^2) & \tau
\end{bmatrix}
$$</p><p>For the measurements let&rsquo;s assume the following model:
$$
z = \sin x_1 + v
$$
This can be interpreted as measuring $y$ coordinate of a gravity pendulum.</p><p>Knowledge on prior statistics on $x_0$ is also available:
$$
\operatorname{E} x_0 = x_0^- \\
\operatorname{E} (x_0 - x_0^-)(x_0 - x_0^-)^T = P_0^-
$$</p><h1 id=numerical-values>Numerical values<a hidden class=anchor aria-hidden=true href=#numerical-values>#</a></h1><p>Here the numerical values used for the simulation are provided.
We assume that $x_1$ is measured in radians and $x_2$ in radians per second.</p><p>Model constants:</p><ul><li>$\omega = \dfrac{2 \pi}{10}$ Hz</li><li>$\eta = 0.5$</li><li>$\xi = 1 \text{ s}^2$</li><li>$\tau = 0.1 \text{ s}$</li></ul><p>Process noise covariance:
$$
Q = \begin{bmatrix}
(0.1 \text{ rad/s})^2 & 0 & 0 \\
0 & 0.01^2 & 0 \\
0 & 0 & (0.5 \text{ rad/s}^2)^2
\end{bmatrix}
$$
Measurement noise covariance:
$$
R = \begin{bmatrix}
0.1^2
\end{bmatrix}
$$
Prior mean and covariance:
$$
x_0^- = \begin{bmatrix}
\pi / 2 \text{ rad} \\
0 \text { rad/s}
\end{bmatrix} \\
P_0^- = \begin{bmatrix}
(0.1 \text{ rad})^2 & 0 \\
0 & (0.05 \text{ rad/s})^2
\end{bmatrix}
$$</p><p>The estimation is run over 1000 epochs with <a href=https://nmayorov.github.io/posts/nonlinear_batch_estimation/#termination>tolerance parameters</a> $t_c = t_f = 10^{-8}$ for the optimization.</p><h1 id=algorithms-results>Algorithm&rsquo;s results<a hidden class=anchor aria-hidden=true href=#algorithms-results>#</a></h1><p>Below the algorithm&rsquo;s metrics by iterations are shown (in log scale for y-axis).</p><p><a href=figs/metrics.svg><img loading=lazy src=figs/metrics.svg alt=metrics></a></p><p>The depicted variables have the following meaning:</p><ul><li>&ldquo;Prior cost&rdquo; &ndash; part of the cost function which accounts for the prior statistics on $x_0$</li><li>&ldquo;Measurement cost&rdquo; &ndash; part of the cost function which accounts for the measurement residuals</li><li>&ldquo;Noise cost&rdquo; &ndash; part of the cost function which accounts for the noise magnitude</li><li>&ldquo;Total cost&rdquo; &ndash; value of the total cost function</li><li>&ldquo;Constraints l1-norm&rdquo; &ndash; l1-norm of the time transition equation residuals (summed over all epochs)</li></ul><p>The solution at iteration 0 is the EKF solution: it has the lowest cost function (zero prior and noise costs), but doesn&rsquo;t at all satisfies time transition equations.
After 1 iteration the cost function almost reaches its optimal value.
Further iterations steadily reduce the constraints violation, which improves the solution smoothness.</p><p>In this problem 1 iteration, which corresponds to one smoother iteration (sort of &#171;Extended Kalman Smoother&#187;), gives a solution very close to the optimal and quite smooth.
But it is generally not guaranteed and the optimization approach gives a proper way to reason about convergence and estimation quality.</p><p>Values of $\mu$ used in the <a href=https://nmayorov.github.io/posts/nonlinear_batch_estimation/#merit-function-and-line-search>merit function</a> by iteration are depicted below</p><p><a href=figs/mu.svg><img loading=lazy src=figs/mu.svg alt=mu></a></p><p>We can see that $\mu$ is increased when necessary as explained in the other post.</p><p>Below the estimated and true values of state variables are depicted.
The plots in the second row enlarges the end part of the plots in the first row.</p><p><a href=figs/state.svg><img loading=lazy src=figs/state.svg alt=state></a></p><p>The estimates obtained by the optimization are smooth and qualitatively more accurate that the EKF estimates.</p><p>The estimated error standard deviations are depicted below.</p><p><a href=figs/sd.svg><img loading=lazy src=figs/sd.svg alt=state></a></p><p>We observe already known from the <a href=https://nmayorov.github.io/posts/verify_smoother/#comparison-of-sample-RMS-and-estimated-SD>linear case</a> relation between filter and smoother standard deviations.</p><p>Monte-Carlo simulation can and should be done to compare sample RMS and estimated SD of filter and optimization solutions.
It won&rsquo;t be included in this post however.</p><h1 id=relation-between-ekf-and-optimized-solutions>Relation between EKF and optimized solutions<a hidden class=anchor aria-hidden=true href=#relation-between-ekf-and-optimized-solutions>#</a></h1><p>We see that EKF solution has a low value of the cost function, but neglects the constraints (state time transition equations).
As the result the estimates don&rsquo;t have any smoothness properties: they are perturbed by the noisy measurements and don&rsquo;t satisfy the time transition equations.
From the optimization perspective the EKF solution is simply infeasible, i.e. it&rsquo;s not considered as a proper solution to the optimization problem.</p><p>The optimization algorithm &#171;smooths&#187; the EKF solution, with each iteration reducing the residual in the state transition equations.
In the process the cost function increases (due to nonzero noise estimates), but it is necessary to satisfy the problem constraints.</p><h1 id=conclusion>Conclusion<a hidden class=anchor aria-hidden=true href=#conclusion>#</a></h1><p>A solution to the batch nonlinear estimation problem as optimization was demonstrated and compared to the EKF solution.
It proved that the optimization is valid and efficient approach for solving nonlinear estimation problems.</p></div><footer class=post-footer><ul class=post-tags></ul></footer></article></main><footer class=footer><span>&copy; 2023 <a href=https://nmayorov.github.io>Navigating Uncertainty</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>