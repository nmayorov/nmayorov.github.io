<!doctype html><html lang=en><head><title>INS error equations · My Blog</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=color-scheme content="light dark"><meta name=description content="In this note I want to derive Inertial Navigation System (INS) error equations in concise and coherent fashion. This is of course a well known subject, however it&rsquo;s useful to derive all the equations from scratch and revisit the subject from time to time.
INS state variables and equations for them Link to heading An Inertial Navigation System computes position, velocity and attitude of a moving object using gyro and accelerometer measurements from an Inertial Measurement Unit (IMU)."><meta name=keywords content><meta name=twitter:card content="summary"><meta name=twitter:title content="INS error equations"><meta name=twitter:description content="In this note I want to derive Inertial Navigation System (INS) error equations in concise and coherent fashion. This is of course a well known subject, however it&rsquo;s useful to derive all the equations from scratch and revisit the subject from time to time.
INS state variables and equations for them Link to heading An Inertial Navigation System computes position, velocity and attitude of a moving object using gyro and accelerometer measurements from an Inertial Measurement Unit (IMU)."><meta property="og:title" content="INS error equations"><meta property="og:description" content="In this note I want to derive Inertial Navigation System (INS) error equations in concise and coherent fashion. This is of course a well known subject, however it&rsquo;s useful to derive all the equations from scratch and revisit the subject from time to time.
INS state variables and equations for them Link to heading An Inertial Navigation System computes position, velocity and attitude of a moving object using gyro and accelerometer measurements from an Inertial Measurement Unit (IMU)."><meta property="og:type" content="article"><meta property="og:url" content="https://nmayorov.github.io/posts/ins_error_equations/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2022-12-20T00:00:00+00:00"><meta property="article:modified_time" content="2022-12-20T00:00:00+00:00"><link rel=canonical href=https://nmayorov.github.io/posts/ins_error_equations/><link rel=preload href="/fonts/forkawesome-webfont.woff2?v=1.2.0" as=font type=font/woff2 crossorigin><link rel=stylesheet href=/css/coder.min.c4d7e93a158eda5a65b3df343745d2092a0a1e2170feeec909b8a89443903c6a.css integrity="sha256-xNfpOhWO2lpls980N0XSCSoKHiFw/u7JCbiolEOQPGo=" crossorigin=anonymous media=screen><link rel=icon type=image/png href=/images/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=/images/favicon-16x16.png sizes=16x16><link rel=apple-touch-icon href=/images/apple-touch-icon.png><link rel=apple-touch-icon sizes=180x180 href=/images/apple-touch-icon.png><link rel=manifest href=/site.webmanifest><link rel=mask-icon href=/images/safari-pinned-tab.svg color=#5bbad5><meta name=generator content="Hugo 0.115.3"></head><body class="preload-transitions colorscheme-light"><div class=float-container><a id=dark-mode-toggle class=colorscheme-toggle><i class="fa fa-adjust fa-fw" aria-hidden=true></i></a></div><main class=wrapper><nav class=navigation><section class=container><a class=navigation-title href=/>My Blog</a>
<input type=checkbox id=menu-toggle>
<label class="menu-button float-right" for=menu-toggle><i class="fa fa-bars fa-fw" aria-hidden=true></i></label><ul class=navigation-list><li class=navigation-item><a class=navigation-link href=/posts/>Posts</a></li></ul></section></nav><div class=content><section class="container post"><article><header><div class=post-title><h1 class=title><a class=title-link href=https://nmayorov.github.io/posts/ins_error_equations/>INS error equations</a></h1></div><div class=post-meta><div class=date><span class=posted-on><i class="fa fa-calendar" aria-hidden=true></i>
<time datetime=2022-12-20T00:00:00Z>December 20, 2022</time></span>
<span class=reading-time><i class="fa fa-clock-o" aria-hidden=true></i>
22-minute read</span></div></div></header><div><p>In this note I want to derive Inertial Navigation System (INS) error equations in concise and coherent fashion.
This is of course a well known subject, however it&rsquo;s useful to derive all the equations from scratch and revisit the subject from time to time.</p><h1 id=ins-state-variables-and-equations-for-them>INS state variables and equations for them
<a class=heading-link href=#ins-state-variables-and-equations-for-them><i class="fa fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h1><p>An Inertial Navigation System computes position, velocity and attitude of a moving object using gyro and accelerometer measurements from an Inertial Measurement Unit (IMU).</p><p>To formulate necessary equations, frames of reference (denoted by lowercase letters) need to be defined:</p><ul><li>$e$ &ndash; Earth-centered, Earth-fixed (ECEF) frame</li><li>$i$ &ndash; inertial frame with axes coinciding with frame $e$ at the initial time</li><li>$n$ &ndash; locally horizontal North-East-Down (NED) frame</li><li>$b$ &ndash; body frame with axes along inertial sensor axes</li></ul><p>A vector $u$ expressed in a frame $x$ is denoted as $u^x$.
A rotation matrix $C^x_y$ projects a vector as $u^x = C^x_y u^y$.</p><p>State variables computed by INS are:</p><ul><li>Geographical position as latitude, longitude and altitude &ndash; $\varphi, \lambda, h$</li><li>Velocity relative to the ground (frame $e$) expressed in frame $n$ &ndash; $V^n = \begin{bmatrix} V_N & V_E & V_D \end{bmatrix}^T$</li><li>Attitude as a rotation matrix from frame $n$ to frame $b$ &ndash; $C^n_b$</li></ul><p>The differential equations for the state variables are:
$$
\dot{\varphi} = \frac{V_N}{R_N + h} \\[1 pt]
\dot{\lambda} = \frac{V_E}{(R_E + h) \cos \varphi} \\
\dot{h} = -V_D \\
\dot{V}^n = -(\omega_{ie}^n + \omega_{in}^n) \times V^n + g^n + C^n_b f^b \\
\dot{C}^n_b = C^n_b [\omega_{ib}^b \times] - [\omega_{in}^n \times] C^n_b
$$
Where the following variables and notation is used:</p><ul><li>$R_N$ and $R_E$ &ndash; North and East curvature radii</li><li>$\omega_{xy}^z$ &ndash; angular rate of frame $y$ relative to frame $x$ expressed in frame $z$:<ul><li>$\omega_{ie}^n$ &ndash; Earth angular rate</li><li>$\omega_{in}^n = \omega_{ie}^n + \omega_{en}^n$ where $\omega_{en}^n$ is transport rate i. e. angular rate of frame $n$ relative to frame $e$ due to object&rsquo;s velocity</li><li>$\omega_{ib}^b$ &ndash; angular rate of the body frame relative to the inertial frame measured by gyroscopes (error free)</li></ul></li><li>$g^n$ &ndash; gravity vector</li><li>$f^b$ &ndash; specific force measured by accelerometers (error free)</li><li>$[u \times]$ &ndash; cross-product skew symmetric matrix, i. e. $[u \times] v \equiv u \times v$</li></ul><p>The INS computer updates the state variables according to the equations using gyro and accelerometers measurements containing errors:
$$
\tilde{\omega}_{ib}^b = \omega_{ib}^b + \epsilon^b \\
\tilde{f}^b = f^b + \nabla^b
$$
Where gyro and accelerometer errors are denoted by $\epsilon^b$ and $\nabla^b$ respectively.
The computed or estimated variables will be marked with hat.</p><h1 id=three-realizations-of-navigation-frame-n>Three realizations of navigation frame $n$
<a class=heading-link href=#three-realizations-of-navigation-frame-n><i class="fa fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h1><p>In INS operation there are 3 realization of navigation frame $n$ (NED frame) which are slightly misaligned to each other:</p><ol><li>True navigation frame $t$ &ndash; NED frame at a true INS location</li><li>Computed navigation frame $c$ &ndash; NED frame at a location computed by INS</li><li>Platform navigation frame $p$ &ndash; frame where accelerometer measurements are projected using estimated matrix $\hat{C}^n_b$
In gimbaled INS this frame is physically realized by a gyro-stabilized platform on which accelerometers are installed</li></ol><p>From the mathematical point of view these frame can be defined as
$$
C^e_t \equiv C^e_n \\
C^e_c \equiv \hat{C}^e_n \\
C^p_b \equiv \hat{C}^n_b
$$</p><p>Small misalignments between the frames are described by rotation vectors according to the following scheme:
$$
\begin{array}{ccccc}
& \theta & & \psi & \\
t & \longrightarrow & c & \longrightarrow & p \\
\end{array} \\
\overrightarrow{\phantom{xxx|}\phi = \theta + \psi\phantom{xxx|}}
$$</p><p>We can give the following interpretation of the misalignment vectors:</p><ul><li>$\phi$ is a full attitude error vector</li><li>$\theta$ is a misalignment vector between true and computed $n$ frames due to the INS position error</li><li>$\psi$ is a part of the attitude error ignoring computed and true $n$ frames misalignment</li></ul><p>Rotation matrices between these system can be expressed to the first order of the introduced rotation vectors as:
$$
C^t_c \approx I + [\theta \times] \\
C^c_p \approx I + [\psi \times] \\
C^t_p \approx I + [\phi \times]
$$</p><p>When the distinction between frames $t$, $c$ and $p$ are not important (for example in coefficients of error equations), we will denote the frame as $n$.</p><h1 id=ins-equations-for-an-arbitrary-frame>INS equations for an arbitrary frame
<a class=heading-link href=#ins-equations-for-an-arbitrary-frame><i class="fa fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h1><p>The velocity and attitude equations can be written for an arbitrary frame $x$ as
$$
\dot{V}^x = -(\omega_{ie}^x + \omega_{ix}^x) \times V^x + g^x + C^x_b f_b \\
\dot{C}^x_b = C^x_b [\omega_{ib}^b \times] - [\omega_{ix}^x \times] C^x_b
$$
Equations for the true velocity and attitude come out with $x = t$.
In the following these equations will be used for frames $c$ and $p$ as well.</p><h1 id=error-definitions>Error definitions
<a class=heading-link href=#error-definitions><i class="fa fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h1><p>Errors must express deviation of estimated variables from true variables.
They don&rsquo;t need to be direct differences of the variables.</p><h2 id=position-error>Position error
<a class=heading-link href=#position-error><i class="fa fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h2><p>Direct differences of latitude and longitude are not particularly convenient to interpret as well as to derive equations for.
Instead we can use correspondence between latitude, longitude, altitude and coordinates in ECEF, which we denote as $r^e$.</p><p>Define the position error as
$$
\Delta r = C^n_e (\hat{r}^e - r^e)
$$
That is it ECEF coordinate errors projected into NED frame.</p><p>Relations between $\Delta r$ and geographic coordinates errors are
$$
\Delta r = \begin{bmatrix}
(R_N + h) \Delta \varphi \\
(R_E + h) \cos \varphi \Delta \lambda \\
-\Delta h
\end{bmatrix}
$$</p><h2 id=velocity-error>Velocity error
<a class=heading-link href=#velocity-error><i class="fa fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h2><p>A velocity error can be defined relative to the true velocity expressed in true, computed or platform frames:
$$
\Delta V = \hat{V} - V^t \\
\partial V = \hat{V} - V^c \\
\delta V = \hat{V} - V^p
$$
Symbol $\partial$ was used simply for the lack of better distinguishable alternatives.</p><p>All these errors are related by a linear transform.
For $\partial V$ we have:
$$
\partial V = \hat{V} - V^c = \hat{V} - C^c_t V^t \approx \hat{V} - [I - (\theta \times)] V^t = \Delta V + \theta \times V^n
$$
And analogously for $\delta V$:
$$
\delta V \approx \Delta V + \phi \times V^n
$$</p><h2 id=attitude-error>Attitude error
<a class=heading-link href=#attitude-error><i class="fa fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h2><p>As an attitude error either vector $\phi$ or $\psi$ can be used.
When $\psi$ is used the full attitude error is computed as $\phi = \theta + \psi$ where $\theta$ is computed from the position error as explained next.</p><h1 id=error-equations-in-general>Error equations in general
<a class=heading-link href=#error-equations-in-general><i class="fa fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h1><p>Error equations are linear differential equations for position, velocity and attitude errors with time varying coefficients, which depend on position, velocity and attitude of INS.
Gyro and accelerometers error also appear in right hand side of the equations.
They are used in estimation algorithms for INS like linearized Kalman filter, Extended Kalman Filter, etc.</p><p>Linearity of the equations are achieved by a linearization process, meaning that the equations are approximate in nature and valid only as long as the errors are small.
The exact meaning of the errors being small will be given in the end.</p><h1 id=helper-formulas>Helper formulas
<a class=heading-link href=#helper-formulas><i class="fa fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h1><p>The curvature radii are computed as
$$
R_N = \frac{a (1 - e^2)}{(1 - e^2 \sin^2 \varphi)^{3/2}} \\
R_E = \frac{a}{1 - e^2 \sin^2 \varphi}
$$
Where $a$ is Earth ellipsoid semi-major axis and $e$ is its eccentricity.
Considering that $e^2 \approx 7 \cdot 10^{-3}$ the dependency of the radii on the latitude is ignored for the error analysis.</p><p>The transport rate is computed as
$$
\omega_{en}^n = \begin{bmatrix}
\dfrac{V_E}{R_E + h} \\
-\dfrac{V_N}{R_N + h} \\
-\dfrac{V_E \tan \varphi}{R_E + h}
\end{bmatrix} = T V^n
$$
It is used in the kinematics equation for $C^e_n$:
$$
\dot{C}^e_n = C^e_n [\omega_{en}^n \times]
$$</p><p>The matrix $T$ relates a linear displacement in $n$ frame to its small angular rotation.
Perturbation of the transport rate due to position and velocity errors can be expressed as
$$
\Delta \omega_{en}^n \equiv \hat{\omega}_{en}^n - \omega_{en}^n \equiv \omega_{ec}^c - \omega_{et}^t \approx R \Delta r + T \Delta V
$$</p><p>Where Jacobian matrices $T$ and $R$ are defined as
$$
T = \begin{bmatrix}
0 & \dfrac{1}{R_E + h} & 0 \\
-\dfrac{1}{R_N + h} & 0 & 0 \\
0 & -\dfrac{\tan \varphi}{R_E + h} & 0
\end{bmatrix} \\[2pt]
R = \begin{bmatrix}
0 & 0 & \dfrac{V_E}{(R_E + h)^2} \\
0 & 0 & -\dfrac{V_N}{(R_N + h)^2} \\
-\dfrac{V_E \sec^2 \varphi}{(R_E + h) (R_N + h)} & 0 & -\dfrac{V_E \tan \varphi}{(R_E + h)^2}
\end{bmatrix}
$$</p><p>By the same logic we can relate the vector $\theta$ with the position error as
$$
\theta \approx T \Delta r
$$</p><p>The Earth rotation rate in $n$ frame has the form
$$
\omega_{ie}^n = C^n_e \omega_{ie}^e \text{ with } \omega_{ie}^e = \begin{bmatrix} 0 & 0 & \Omega \end{bmatrix}^T
$$
Its perturbation due to the position error can be expressed as
$$
\Delta \omega_{ie}^n \equiv \hat{\omega}_{ie}^n - \omega_{ie}^n \equiv \omega_{ie}^c - \omega_{ie}^t \approx \omega_{ie}^n \times \theta \approx (\omega_{ie}^n \times) T \Delta r^n
$$</p><p>The gravity model is
$$
g^n = \begin{bmatrix}
0 \\
0 \\
g(\varphi) \left(1 - \dfrac{2 h}{a} \right)
\end{bmatrix}
$$
The weak dependency in $g(\varphi)$ can be ignored in the error analysis.
Perturbation of the gravity vector due to the position error is
$$
\Delta g^n \equiv \hat{g}^n - g^n \approx G \Delta r
$$
with the Jacobian matrix
$$
G = \begin{bmatrix}
0 & 0 & 0 \\
0 & 0 & 0 \\
0 & 0 & \dfrac{2 g}{a} \\
\end{bmatrix}
$$</p><h1 id=differential-equation-for-a-small-rotation-vector-as-attitude-error>Differential equation for a small rotation vector as attitude error
<a class=heading-link href=#differential-equation-for-a-small-rotation-vector-as-attitude-error><i class="fa fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h1><p>Consider the rotation kinematics equation for a matrix $C$:
$$
\dot{C} = C [\omega \times] - [\xi \times] C
$$
Where $\omega$ and $\xi$ are angular rates of the frames between which $C$ transforms relative to some third frame.
And the same dynamics for its estimate:
$$
\dot{\hat{C}} = \hat{C} [(\omega + \Delta \omega) \times] - [(\xi + \Delta \xi) \times] \hat{C}
$$
Define the relation between the matrices to the first order in a rotation vector $\alpha$ as
$$
C \approx (I + [\alpha \times]) \hat{C}
$$
From this we get the differential equation for $\alpha$:
$$
\begin{split}
[\dot{\alpha} \times] = \dot{C} \hat{C}^T + C \dot{\hat{C}}^T = (C [\omega \times] - [\xi \times] C ) \hat{C}^T + C(-[(\omega + \Delta \omega) \times] \hat{C}^T + \hat{C}^T [(\xi + \Delta \xi) \times]) = \\
= -C [\Delta \omega \times] \hat{C}^T - [\xi \times] C \hat{C}^T + C \hat{C}^T [(\xi + \Delta \xi) \times]
\end{split}
$$
The first term is already linear in the error, thus in it we can replace $\hat{C}$ with $C$.
In the second and third terms we substitute $C \hat{C}^T \approx I + [\alpha \times]$:
$$
\begin{split}
[\dot{\alpha} \times] \approx -C [\Delta \omega \times] C^T - [\xi \times] (I + [\alpha \times]) + (I + [\alpha \times]) [(\xi + \Delta \xi) \times] = \\
\approx -C [\Delta \omega \times] C^T + [\Delta \xi \times] + [\alpha \times] [\xi \times] - [\xi \times] [\alpha \times]
\end{split}
$$
This equation can be transformed to a vector form using easy to proof identities:
$$
C [u \times] C^T = [(C u) \times] \text{ if $C$ is a rotation matrix} \\
$$
$$
[u \times][v \times] - [v \times][u \times] = [(u \times v) \times]
$$</p><p>After applying them we get a relation for skew symmetric matrices, which can be written in an equivalent vector form:
$$
\dot \alpha = -C \Delta \omega + \Delta \xi - \xi \times \alpha
$$</p><h1 id=phi-angle-error-model>$\phi$-angle error model
<a class=heading-link href=#phi-angle-error-model><i class="fa fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h1><p>In this error model $\Delta r, \Delta V$ and $\phi$ are used as the error variables.
Conceptually this is the most straightforward approach where error equations are essentially derived as perturbation of nominal INS equations.</p><h2 id=position-error-equation>Position error equation
<a class=heading-link href=#position-error-equation><i class="fa fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h2><p>Differentiating the position error we get
$$
\begin{split}
\Delta \dot{r} = \dot{C}^n_e (\hat{r}^e - r^e) + C^n_e (\dot{\hat{r}}^e - \dot{r}^e) = -[\omega_{en}^n \times] C^n_e (\hat{r}^e - r^e) + C^n_e (\hat{V}^e - V^e) = \\
= -\omega_{en}^n \times \Delta r + C^n_e \hat{C}^e_n \hat{V}^n - V^n \approx -\omega_{en}^n \times \Delta r + (I + [\theta \times]) (V^n + \Delta V^n) - V^n \approx \\
\approx -\omega_{en}^n \times \Delta r + \Delta V + \theta \times V^n
\end{split}
$$</p><p>Substituting $\theta = T \Delta r$ we get:
$$
\Delta \dot{r} = -\left( [\omega_{en}^n \times] + [V^n \times] T \right) \Delta r + \Delta V
$$</p><h2 id=velocity-error-equation>Velocity error equation
<a class=heading-link href=#velocity-error-equation><i class="fa fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h2><p>To derive the velocity error equation we subtract the equation for the true velocity from the equation for the INS estimated velocity keeping terms linear in the errors:
$$
\Delta \dot{V} = -(2 \omega_{ie}^n + \omega_{en}^n) \times \Delta V - (2 \Delta \omega_{ie}^n + \omega_{en}^n) \times V^n + \Delta g^n + (I - [\phi \times]) C^n_b (f^b + \nabla^b) - C^n_b f^b
$$
Substituting expressions for all $\Delta$-s we get
$$
\Delta \dot{V} = -(2 \omega_{ie}^n + \omega_{en}^n) \times \Delta V + [V^n \times] (2 [\omega_{ie}^n \times] T \Delta r^n + R \Delta r^n + T \Delta V^n) + G \Delta r^n + (C^n_b f^b) \times \phi + C^n_b \nabla^b
$$
And after the grouping the terms:
$$
\Delta \dot{V} = (2 [V^n \times] [\omega_{ie}^n \times] T + [V^n \times] R + G ) \Delta r + (-[(2 \omega_{ie}^n + \omega_{en}^n)\times] + [V^n \times] T) \Delta V + (C^n_b f^b) \times \phi + C^n_b \nabla^b
$$</p><h2 id=attitude-error-equation>Attitude error equation
<a class=heading-link href=#attitude-error-equation><i class="fa fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h2><p>Applying the general equation for an attitude error vector to the matrix $C^n_b$ we get
$$
\dot{\phi} = -C^n_b \epsilon^b + \Delta \omega_{en}^n + \Delta \omega_{ie}^n - (\omega_{ie}^n + \omega_{en}^n) \times \phi
$$
And after Substituting the angular rate errors:
$$
\dot{\phi} = (R + [\omega_{ie}^n \times] T) \Delta r + T \Delta V - (\omega_{ie}^n + \omega_{en}^n) \times \phi -C^n_b \epsilon^b
$$</p><h1 id=psi-angle-error-model>$\psi$-angle error model
<a class=heading-link href=#psi-angle-error-model><i class="fa fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h1><p>In this error model $\Delta r, \partial V$ and $\psi$ are used as the error variables.
This model is often considered as an alternative to $\phi$-angle model and thus I decided to describe it.</p><h2 id=position-error-equation-1>Position error equation
<a class=heading-link href=#position-error-equation-1><i class="fa fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h2><p>To derive the position error equations we take the equation from the $\phi$-model:
$$
\Delta \dot{r} \approx -\omega_{en}^n \times \Delta r + \Delta V + \theta \times V^n \approx -\omega_{en}^n \times \Delta r + \partial V
$$
We can see that $\partial V$ is in some sense the most natural variable to describe the position error growth.</p><h2 id=velocity-error-equation-1>Velocity error equation
<a class=heading-link href=#velocity-error-equation-1><i class="fa fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h2><p>Let&rsquo;s write differential equations for $\hat{V}$ and $V^c$ using the common notation:
$$
\dot{\hat{V}} = -(2 \omega_{ie}^c + \omega_{ec}^c) \times \hat{V} + \hat{g}^n + C^p_b (f^b + \nabla^b) \\
\dot{V}^c = -(2 \omega_{ie}^c + \omega_{ec}^c) \times V^c + g^c + C^c_b f^b
$$
Also consider relations
$$
C^p_b \approx (I - [\psi \times]) C^c_b \\
\hat{g}^n = g^n + \Delta g^n \\
g^c = C^c_t g^t \approx (I - [\theta \times]) g^n = g^n + g^n \times \theta \\
$$
Taking the difference of the equations and using the above relations we get to the first order of the errors:
$$
\partial \dot{V} = -(2 \omega_{ie}^n + \omega_{en}^n) \times \partial V + \Delta g^n - g^n \times \theta + (C^n_b f^b) \times \psi + C^n_b \nabla^b
$$
Substitute expressions for $\Delta g^n$ and $\theta$ to finally get
$$
\partial \dot{V} = (G - [g^n \times] T) \Delta r - (2 \omega_{ie}^n + \omega_{en}^n) \times \partial V + (C^n_b f^b) \times \psi + C^n_b \nabla^b
$$</p><h2 id=attitude-error-equation-1>Attitude error equation
<a class=heading-link href=#attitude-error-equation-1><i class="fa fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h2><p>Let&rsquo;s write differential equations for $\hat{C}^n_b$ and $C^c_b$ which are misaligned by vector $\psi$:
$$
\dot{\hat{C}}^n_b = \hat{C}^n_b [(\omega_{ib}^b + \epsilon^b) \times] - [\omega_{ic}^c \times] \hat{C}^n_b \\
\dot{C}^c_b = C^c_b [\omega_{ib}^b \times] - [\omega_{ic}^c \times] C^c_b
$$
We see that the second angular velocity $\omega_{ic}^c$ is the same in both equations.
Thus using the general equation for an attitude error vector we get
$$
\dot{\psi} = -(\omega_{ie}^n + \omega_{en}^n) \times \psi - C^n_b \epsilon^b
$$</p><h1 id=modified-phi-vector-error-model>Modified $\phi$-vector error model
<a class=heading-link href=#modified-phi-vector-error-model><i class="fa fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h1><p>In this error model $\Delta r, \delta V$ and $\phi$ are used as the error variables.
This model was not considered by early researchers, but was discovered later and found to be the most advantageous to use in practice.</p><h2 id=formula-for-omega_ipp>Formula for $\omega_{ip}^p$
<a class=heading-link href=#formula-for-omega_ipp><i class="fa fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h2><p>In the following we will need an expression for $\omega_{ip}^p$.
To derive it we write the equation for $C^p_b$ in two different ways:</p><ul><li>As executed by the INS computer: $\dot{C}^p_b = C^p_b [(\omega_{ib}^b + \epsilon^b)] - [\omega_{ic}^c \times] C^p_b$</li><li>Using the general equation for a frame $p$: $\dot{C}^p_b = C^p_b [\omega_{ib}^b \times] - [\omega_{ip}^p \times] C^p_b$</li></ul><p>Equating right hand sides we get:
$$
C^p_b [(\omega_{ib}^b + \epsilon^b) \times] - [\omega_{ic}^c \times] C^p_b = C^p_b [\omega_{ib}^b \times] - [\omega_{ip}^p \times] C^p_b \\
C^p_b [\epsilon^b \times] (C^p_b)^T - [\omega_{ic}^c \times ] = -[\omega_{ip}^p \times] \\
\omega_{ip}^p = \omega_{ic}^c - C^n_b \epsilon^b
$$</p><h2 id=position-error-equation-derivation>Position error equation derivation
<a class=heading-link href=#position-error-equation-derivation><i class="fa fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h2><p>Taking the equation from the $\phi$-error model and expressing $\Delta V$ via $\delta V$ we get
$$
\Delta \dot{r} = -\left( [\omega_{en}^n \times] + [V^n \times] T \right) \Delta r + \delta V + V^n \times \phi
$$
Here we see that the attitude and position errors are directly coupled.</p><h1 id=velocity-error-derivation>Velocity error derivation
<a class=heading-link href=#velocity-error-derivation><i class="fa fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h1><p>Let&rsquo;s write differential equations for $\hat{V}$ and $V^p$ using the common notation:
$$
\dot{\hat{V}} = -(\omega_{ie}^c + \omega_{ic}^c) \times \hat{V} + \hat{g}^n + C^p_b (f^b + \nabla^b) \\
\dot{V}^p = -(\omega_{ie}^p + \omega_{ip}^p) \times V^p + g^p + C^p_b f^b
$$
Also consider relations
$$
\hat{g}^n = g^n + \Delta g^n \\
g^p = C^p_t g^t \approx (I - [\phi \times]) g^n = g^n + g^n \times \phi \\
\omega^p_{ie} = C^p_c \omega^c_{ie} \approx (I - [\psi \times]) \omega^c_{ie} = \omega^c_{ie} + \omega^c_{ie} \times \psi \\
\omega^p_{ip} = \omega^c_{ic} - C^n_b \varepsilon^b
$$
Taking the difference of the velocity equations and using the above relations we get to the first order in the errors:
$$
\delta V = V^n \times (-\omega_{ie}^n \times \psi + C^n_b \epsilon^b) - (2 \omega_{ie}^n + \omega_{en}^n) \times \delta V^n + \Delta g^n - g^n \times \phi + C^n_b \nabla^b
$$
Substituting $\psi = \phi - \theta \approx \phi - T \Delta r, \Delta g^n \approx G \Delta r$ and grouping the terms we finally get
$$
\delta \dot{V} = (G + [V^n \times][\omega_{ie}^n \times] T ) \Delta r - (2 \omega_{ie}^n + \omega_{en}^n) \times \delta V^n - ([g^n \times] + [V^n \times][\omega_{ie}^n \times]) \phi + C^n_b \nabla^b + [V^n \times] C^n_b \epsilon^b
$$
The most notable property of this equation is absence of specific force measurements $f^b$.</p><h2 id=attitude-error-equations>Attitude error equations
<a class=heading-link href=#attitude-error-equations><i class="fa fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h2><p>Start from the equation already derived:
$$
\dot{\phi} = (R + [\omega_{ie}^n \times] T) \Delta r + T \Delta V - (\omega_{ie}^n + \omega_{en}^n) \times \phi -C^n_b \epsilon^b
$$
Expressing $\Delta V$ via $\delta V$ we get
$$
\dot{\phi} = (R + [\omega_{ie}^n \times] T) \Delta r + T \delta V + (T [V^n \times] - [(\omega_{ie}^n + \omega_{en}^n) \times]) \phi -C^n_b \epsilon^b
$$</p><h1 id=validity-of-error-models>Validity of error models
<a class=heading-link href=#validity-of-error-models><i class="fa fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h1><p>The derivations were done using several first order approximations.
These approximations are valid if higher order truncated terms are insignificant compared to the first order (linear) terms.</p><p>For the attitude error vectors we&rsquo;ve used linear approximations like $C^t_p \approx I + [\phi \times]$.
Thus it is obvious that the requirement for them are
$$
\phi \ll 1 \\
\psi \ll 1
$$
A safe limit on the attitude errors for algorithms like EKF is approximately 0.1 radian or 5 degrees.</p><p>We&rsquo;ve also used an assumption that the vector $\theta$ is small. It means that
$$
\Delta r \ll a
$$
Considering that Earth radius $a \approx 6400$ km, we can estimate the limit of an acceptable position error as 500 km.
This value far exceeds useful range of INS accuracy.</p><p>The situation with the velocity error is more interesting.
In $\psi$-angle error model there is no truncation of higher order terms featuring $\partial V$.
This is an interesting property which could also be derived or understood by considering kinematic equations in ECEF frame, which are linear in $V^e$.
However if we try to predict $\Delta V \approx \partial V + V^n \times \theta $ or $\delta V \approx \partial V - V^n \times \psi$ errors (necessary for NED or body frame velocity processing in estimation algorithms), we will need to use the estimated velocity $\hat{V} = V^n + \Delta V$.
And then for $\hat{V} \times \theta$ and $\hat{V} \times \psi$ to be valid to the first order it must hold
$$
\Delta V \ll V^n
$$
For $\phi$-angle error model and its modified version other (but conceptually similar) arguments might be made to come up with the same conclusion.</p><h1 id=summary-and-discussion>Summary and discussion
<a class=heading-link href=#summary-and-discussion><i class="fa fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h1><p>Let&rsquo;s summarize all the models, discuss their possible simplifications, properties and relations to each other.</p><h2 id=phi-angle-error-model-1>$\phi$-angle error model
<a class=heading-link href=#phi-angle-error-model-1><i class="fa fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h2><p>$$
\Delta \dot{r} = -\left( [\omega_{en}^n \times] + [V^n \times] T \right) \Delta r + \Delta V \\
\Delta \dot{V} = (2 [V^n \times] [\omega_{ie}^n \times] T + [V^n \times] R + G ) \Delta r + (-[(2 \omega_{ie}^n + \omega_{en}^n)\times] + [V^n \times] T) \Delta V + (C^n_b f^b) \times \phi + C^n_b \Delta f \\
\dot{\phi} = (R + [\omega_{ie}^n \times] T) \Delta r + T \Delta V - (\omega_{ie}^n + \omega_{en}^n) \times \phi -C^n_b \epsilon^b
$$</p><p>Expanding the equation for the vertical position error we&rsquo;ll get
$$
\Delta r_D = \Delta V_D
$$
which agrees with the simple kinematics equations for the altitude $\dot{h} = -V_D$.</p><p>The formulas can be simplified if position errors are estimated and corrected (using GNSS, etc.)
In this case it can be assumed that $V \Delta r / a \ll \Delta V$.
Then in all the formulas terms with $\Delta r$ can be neglected in comparison with terms with $\Delta V$ (except $G \Delta r$!).</p><h2 id=psi-angle-error-model-1>$\psi$-angle error model
<a class=heading-link href=#psi-angle-error-model-1><i class="fa fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h2><p>$$
\Delta \dot{r} = -\omega_{en}^n \times \Delta r + \partial V \\
\partial \dot{V} = (G - [g^n \times] T) \Delta r - (2 \omega_{ie}^n + \omega_{en}^n) \times \partial V + (C^n_b f^b) \times \psi + C^n_b \nabla^b \\
\dot{\psi} = -(\omega_{ie}^n + \omega_{en}^n) \times \psi - C^n_b \epsilon^b
$$</p><p>These equations already look simple enough which is probably the main advantage of this model.</p><h2 id=modified-phi-angle-error-model>Modified $\phi$-angle error model
<a class=heading-link href=#modified-phi-angle-error-model><i class="fa fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h2><p>$$
\Delta \dot{r} = -\left( [\omega_{en}^n \times] + [V^n \times] T \right) \Delta r + \delta V + V^n \times \phi \\
\delta \dot{V} = (G + [V^n \times][\omega_{ie}^n \times] T ) \Delta r - (2 \omega_{ie}^n + \omega_{en}^n) \times \delta V^n - ([g^n \times] + [V^n \times][\omega_{ie}^n \times]) \phi + C^n_b \nabla^b + [V^n \times] C^n_b \epsilon^b \\
\dot{\phi} = (R + [\omega_{ie}^n \times] T) \Delta r + T \delta V + (T [V^n \times] - [(\omega_{ie}^n + \omega_{en}^n) \times]) \phi -C^n_b \epsilon^b
$$</p><p>If desired the equations can be simplified with assumption of $V \Delta r / a \ll \Delta V$ and $V \Omega \ll g$ as
$$
\Delta \dot{r} = \delta V + V^n \times \phi \\
\delta \dot{V} = (G + [V^n \times][\omega_{ie}^n \times] T ) \Delta r - (2 \omega_{ie}^n + \omega_{en}^n) \times \delta V^n - g^n \times \phi + C^n_b \nabla^b + [V^n \times] C^n_b \epsilon^b \\
\dot{\phi} = T \delta V + (T [V^n \times] - [(\omega_{ie}^n + \omega_{en}^n) \times]) \phi -C^n_b \epsilon^b
$$</p><h2 id=discussion-of-phi-and-psi-angle-error-models>Discussion of $\phi$ and $\psi$-angle error models
<a class=heading-link href=#discussion-of-phi-and-psi-angle-error-models><i class="fa fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h2><p>$\phi$-angle $\psi$-angle error models are not substantially different and represent the following essential error dynamics:</p><ul><li>Position error equation is straightforward: higher the velocity error &ndash; quicker position error grows</li><li>Rate of change of the vertical velocity error is influenced mainly by incorrectly computed gravity because of the altitude error</li><li>Roll and pitch errors create incorrect gravity projection and horizontal velocity error growth</li><li>When horizontal acceleration is present, incorrect heading ($\phi_D, \psi_D$) causes horizontal error growth</li><li>Projected accelerometer errors also directly contribute to the rate of change of the velocity error</li><li>Attitude errors grow approximately with a rate equal to the projected gyro errors</li></ul><p>In $\psi$ model roll and pitch errors are formed by horizontal $\psi$ components and horizontal position errors.
There is an oscillation mode of roll, pitch, horizontal position and velocity errors called Schuller oscillations with period of approximately 84 minutes.
Unlike the $\phi$ vector, the $\psi$ vector is free from these oscillations.</p><p>Equations of $\psi$-angle error model are simpler, however the indirect and tricky nature of $\psi$ vector makes them not appealing for use in practice in my opinion.
For example when the attitude of a stationary INS is estimated by averaging accelerometers (roll and pitch estimation) and gyroscopes (heading estimation by gyrocompassing), we can determine covariance of $\phi$ angle and its correlation with the inertial sensor biases.
But if $\psi$ angle is used we need to account for the interplay between $\phi$ and $\theta$ vectors to get the initial covariance of $\psi$ angle and correlations with other states.</p><h2 id=discussion-of-modified-phi-angle-error-model>Discussion of modified $\phi$-angle error model
<a class=heading-link href=#discussion-of-modified-phi-angle-error-model><i class="fa fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h2><p>Modified $\phi$-angle error model differ substantially from the two other models.
In this model we can though of the estimated velocity as being expressed in the platform frame.
The misalignment of the platform frame from the true frame causes incorrect velocity projection when updating position and the position error growth as $V^n \times \phi$.
The velocity estimates in the platform frame also contains error $\delta V$, influenced only by accelerometer errors and incorrect projection of gravity (mainly).
Measurements of odometric type (odometer, doppler radar, etc.) allow estimation of only $\delta V$.
That is in this model we get a nice separation of the full velocity error into odometric part $\delta V$ and misalignment part $V^n \times \phi$.</p><p>Another big advantage is that it doesn&rsquo;t require specific force measurements $f^b$ for its implementation.
It allows modelling of INS errors using only trajectory data and alleviates the question of required time step for error equations time propagation as $f^b$ can be a wide-band signal.</p><p>This model is also related to a modern viewpoint of the estimation on Lie groups.
From this perspective the combination of velocity and attitude can be thought as elements of $SE(3)$ group and its errors as Lie algebra elements (defined on the left).
Using this perspective correction of velocity and attitude by the estimated errors can be done coherently using special Lie algebra elements exponentiation.</p><h1 id=practical-considerations>Practical considerations
<a class=heading-link href=#practical-considerations><i class="fa fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h1><p>The equations was written as if using true values of the variables to compute its coefficients.
In practice estimated values (as only available) are used for that, it doesn&rsquo;t violate the validity of the equations to the first order in the errors.
However it might create consistency issues in estimation algorithms and some special care must be taken in practical systems.</p><p>For example when $V^n = 0$ then the small velocity error condition $\Delta V \ll V^n$ doesn&rsquo;t hold.
It means that we must assure that zero velocity is substituted in error propagation and measurements model coefficients in this case.
The problematic term in the modified $\phi$-angle error model is $V^n \times \phi$ in the position error equation.
We must assure that zero velocity is substituted in it to avoid creating false coupling between position and attitude error states.</p><p>As for the model selection, the modified $\phi$-angle error model seems to be the most advantageous due to its useful conceptual and practical properties described above.</p><h1 id=conclusion>Conclusion
<a class=heading-link href=#conclusion><i class="fa fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h1><p>I&rsquo;ve presented a derivation of 3 different INS error models in a uniform and concise fashion, discussed their essential properties and differences between each other.
Coefficients of the error equations were given as explicit matrices, which can be used directly for estimation algorithms implementations.</p></div><footer></footer></article><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/katex.min.css integrity=sha384-R4558gYOUz8mP9YWpZJjofhk+zx0AS11p36HnD2ZKj/6JR5z27gSSULCNHIRReVs crossorigin=anonymous><script defer src=https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/katex.min.js integrity=sha384-z1fJDqw8ZApjGO3/unPWUPsIymfsJmyrDVWC8Tv/a1HeOtGmkwNd/7xUS0Xcnvsx crossorigin=anonymous></script>
<script defer src=https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/contrib/auto-render.min.js integrity=sha384-+XBljXPPiv+OzfbB3cVmLHf4hdUFHlWNZN5spNQ7rmHTXpd7WvJum6fIACpNNfIR crossorigin=anonymous onload='renderMathInElement(document.body,{delimiters:[{left:"$$",right:"$$",display:!0},{left:"$",right:"$",display:!1},{left:"\\(",right:"\\)",display:!1},{left:"\\[",right:"\\]",display:!0}]})'></script></section></div><footer class=footer><section class=container>©
2023
·
Powered by <a href=https://gohugo.io/>Hugo</a> & <a href=https://github.com/luizdepra/hugo-coder/>Coder</a>.</section></footer></main><script src=/js/coder.min.236049395dc3682fb2719640872958e12f1f24067bb09c327b233e6290c7edac.js integrity="sha256-I2BJOV3DaC+ycZZAhylY4S8fJAZ7sJwyeyM+YpDH7aw="></script></body></html>